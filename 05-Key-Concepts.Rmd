#Key Concepts {#keyconcepts}

This section explains some key concepts in Project Big Life’s Planning Tool. This section will explain how it works rather then how to do things.

- Data and sample files
- Multivariable predictive risk algorithms
- Calculations

    - Risk of health outcome
    - Number of health outcomes
    - Life expectancy
    - Cause-deleted
    
- Health intervention scenarios


##Data and sample files

The Project Big Life Planning Tool currently accepts **2013/2014 Public Use Microdata File and Shared File of the Canadian Community Health Survey (CCHS) in '.csv' format.**

The CCHS is an annual cross-sectional survey preformed by Statistics Canada. The CCHS collects information related to health status, health care utilization, and health determinants for the Canadian population. Data is shared at the the sub-provincial geographic level (health region or combination of health regions).

- Details about the survey and its design can be found on Statistic Canada website  (http://www23.statcan.gc.ca/imdb/p2SV.pl?Function=getSurvey&Id=144170). 
- Details and access to the Public Use Microdata file (PUMF) can be found on the Odesi website (https://search2.odesi.ca/#/details?uri=%2Fodesi%2Fcchs-82M0013-E-2013-2014-Annual-component.xml)

###Sample Files

- MockPUMF2013.csv is a subsample of the Public Use Microdata File from the [2013 Canadian Community Health Survey] (https://www150.statcan.gc.ca/n1/en/catalogue/82M0013X). It includes variables: age, sex, BMI, smoking habits, alcohol consumption, diet components, physical activity levels, chronic conditions, ethinicity, immigration status, and education. 



##Multivariable predictive risk algorithms

Multivariable predictive risk algorithms predict the future risk of health outcomes (e.g. Life Expectancy) for a population using routinely collected health data.

Multivariable predictive risk algorithms can be used to:

- Project the number of new cases of the health outcome
- Estimate the contribution of specific risk factors of the health outcome
- Evaluate effectiveness of health interventions
- Describe the distribution of risk in the population (diffused or concentrated)

Multivariable predictive risk algorithms are able to assess equity issues compared to competing population risk methods (e.g. World Health Organization Global Burden of Disease).

More information on what multivariable predictive risk algorithms are and how they can be used can be found the journal article: *Predictive risk algorithms in a population setting: an overview* [@PoRTover]

###Development of multivariable predictive risk algorithms

**Data:**

-	Multivariable predictive risk algorithms are created using routinely collected data that includes information about risk factors (exposure) and health events (outcomes).
-	Data is collected at an individual level through population health surveys (e.g. Canadian Community Health Survey) and administrative databases (e.g. Vital Statistics). Data sources are linked together when the individual has given permission too.
- Individuals are followed overtime until the health event (e.g. death or disease) occurs.
- Separate data is collected to create a derivation cohort and validation cohort(s). 

    - Note: The risk factors that are collected are from population health surveys and are self-reported; no clinical data (e.g. blood pressure) is collected. Risk factors focus on health behaviours (e.g. smoking) and sociodemographic factors, commonly associated with health outcome.

**Algorithm generation:**

- Multivariable predictive risk algorithms are cox porportional hazard models that analyze time to health outcome (e.g. death) *Question for Carol - The models are not cox-porportional hazard models but they are similar?*

- Multivariable predictive risk algorithms are developed and validated in 4 stages:

    - Algorithm derivation: the predictive risk algorithm is created using data from the derivation cohort
    - Algorithm validation: the predictive risk algorithm is applied to the validation cohort
    - Final algorithm generation: validation and derivation cohorts are combined to estimate the final application of the predictive risk algorithm 
    - Derivation of the application algorithm: creation of a parsimonous (fewer predictors) algorithm that maintained discrimination, calibration, and overall algorithm performance
    
- In each stage of the algorithm development and validation, algorithm performance is assessed using measures of discrimination and calibration.

###Multivariable predictive risk algorithms built in Project Big Life Planning Tool

- There is currently 1 multivariable predictive risk algorithm is built into to Project Big Life planning tool.
```{r, echo=FALSE, results='hide', message=FALSE}
library(knitr)
library(kableExtra)
#Replicated Table 1 from MPoRTv2 Figures - Predictor variables for the MPoRTv2
(PoRTs <- data.frame(
    Title = c("Mortality Population Risk Tool"),
    Outcomes = c("5 year risk of death, Life Expectancy, Cause deleted"),
    Information =c("Appendix A"))
    )#closingbracket 
```
```{r, echo=FALSE}
#Creating the table
kable(PoRTs) %>%
  kable_styling(full_width = T)
```


##Calculations

###Risk of health outcome

Risk of the health outcome (e.g. risk of dying) is the outcome of the multivariable predictive risk algorithm. An example of the mutlivariable risk algorithm is:

$$ \text{Risk} = \sum_t h_0(t) * e^{\beta_{pred.smoking}*x_{smoking}+\beta_{pred.cancer}*x_{cancer} + \beta_{pred.male}*x_{male} +...}  $$
Where:

- $t$ = survival time
- $h_0(t)$ = the baseline hazard
- $\beta_{pred}$ = predictive hazard ratios for the exposures
- $x$ = the exposure (e.g. $x_{smoking}$ can have the value: current smoker, former smoker <=5 years, former smoker > 5 years, or never smoker). 

###Number of health outcomes

The number of health outcomes (e.g. Summary Deaths) is calculated through the following steps:

1. Risk of the health outcome is calculated for each individual in the dataset using the mutlivariable predictive risk algorithm.
2. The weighted mean of all the risks is calculated using individual risk values and corresponding study weights (CCHS variable: WTS_M).
3. The weighted mean is then multiplied with the total number of individuals in the population to generate the number of health outcomes (e.g. number of deaths in 5 years).


###Life expectancy calculation

Life expectancy is calculated using abridge life tables:

1. The mortality risk for each individual is calculated using the mutlivariable predictive risk algorithm for mortality (MPoRT \@ref(appedA)).
2. Mortality risks for each individual are weighted using the corresponding survey weights (CCHS variable - WTS_M).
3. Weighted mortality risks are then used in sex-specific 5-year abridge period life tables.
4. Life expectancy was then calculated using these 5-year abridge period life tables. 


###Cause-deletion calculations

What would be the life expectancy of a population if be no one in the population ever smoked? This scenario is a cause-deleted scenario.


*To Do: Insert video of cause deleted calculations that explains Method 1 vs. Method 2*



There are two parts to the cause-deleted calculations: (A) calculate the risk, and (B) calculate the health outcome: life expectancy or number of deaths.

**Part A: Risk calculations**

The original multivariable predictive risk algorithm is: 

$$ \text{Risk} = \sum_t h_0(t) * e^{\beta_{pred.smoking}*x_{smoking}+\beta_{pred.cancer}*x_{cancer} + \beta_{pred.male}*x_{male} +...}  $$


**Step 1.** Modify the original algorithm to include the external coefficient(s). This means replacing all predictive hazard ratios/betas related to the health behaviour to the causal hazard ratios/betas. 

- Remove the original regression coefficient(s) for the health behaviour.
- Add the new external coefficient(s) to the algorithm. External coefficients are generated from either: causal models, or from systematic reviews or meta-analysis.

$$ \text{External coefficient risk} = \sum_t h_0(t) * e^{{\beta_\textbf{causal.smoking}}*x_{smoking} + {{\beta_\textbf{causal.cancer}}}*x_{cancer} + \beta_{pred.male}*x_{male} +...}  $$
    

**Step 2.**	Risk is calculated using the modified algorithm created in Step 1 and the respondent’s original profile (e.g. current smoker). This is the “external coefficient risk”. 

$$ \text{External coefficient risk} = \sum_t h_0(t) * e^{\beta_{causal.smoking}* {(\textbf{current smoker})} + \beta_{causal.cancer}*x_{cancer} + \beta_{pred.male}*x_{male} +...}  $$


**Step 3.**	“Cause-deleted risk' " is calculated by setting an exposure to a reference (non-exposed) value (all other risk exposures remain unchanged).

$$ \text{Cause-deleted risk' } = \sum_t h_0(t) * e^{\beta_{causal.smoking}* {(\textbf{never smoker})} + \beta_{causal.cancer}*x_{cancer} + \beta_{pred.male}*x_{male} +...}  $$


**Step 4.**	The “cause-deleted effect external” is calculated as “external coefficient risk” (Step 2) minus the “cause-deleted risk’. ”(Step 3).

$$\text{Cause-deleted effect}_{external} = \text{External coefficient risk} - \text{Cause-deleted risk'}$$


**Step 5.**	Original risk is calculated using the original algorithm and the original respondent’s profile.

$$ \text{Original risk} = \sum_t h_0(t) * e^{{\beta_\textbf{pred.smoking}}*{(\textbf{current smoker})}+{\beta_\textbf{pred.cancer}}*x_{cancer} + \beta_{pred.male}*x_{male} +...}  $$


**Step 6.**	The “cause-deleted risk external” is calculated by “original risk” (Step 5) minus the “cause-deleted effect external” (Step 4).

$$\text{Cause-deleted risk}_{ external} = \text{Original risk} - \text{Cause-deleted effect}_{external}$$

```{r, echo=FALSE, fig.align='center', fig.cap= "Risk porportion of cause-deleted calculations"}
knitr::include_graphics("Method2 only -cbf.jpg")
```


**Part B: Health outcome calculations**

Using risks generated above you can then calculate:

- cause-deleted life expectancy or life years lost attributable to a health behaviour (exposure)
- cause-deleted number of deaths or number of deaths attributable to a health behaviour (exposure)


**Life expectancy calculations**

Step I: Calculate the original life expectancy by using the original risk (Step 5 above) in the sex-specific 5-year abridge period life tables.

Step II: Calculate the cause-deleted life expectancy by using the cause-deleted risk external (Step 6 above) in the sex-specific 5-year abridge period life tables.

Step III: Calculate life years lost attributable to a health behaviour by: original life expectancy (Step I) minus cause-deleted life expectancy (Step II):

$$ \text{Life years lost} = \text{Original life expectancy} - \text{Cause-deleted life expectancy}$$


**Number of deaths calculations**

Step I: Calculate the number of deaths that would occur using the original risk (Step 5 above).

Step II: Calculate the number of deaths that would occur using the cause-deleted risk external (Step 6 above).

Step III: Calculate the number of deaths that are attributable to a health behaviour (exposure) by: original number of deaths (Step I) minus cause-deleted number of deaths (Step II):

$$\text{Deaths due to exposure} = \text{Original number of deaths} - \text{Cause-deleted number of deaths}$$

## Health interventions scenarios

*TBD: whether this will be built into the platform or not. Depending on the outcome will dictate how I write the following section (e.g. do they have to manipulate thier data)*
